# See the documentation for more information:
# https://packit.dev/docs/configuration/

# Generated by `make-srpm.sh` script
specfile_path: dist/osh.spec

# add or remove files that should be synced
files_to_sync:
    - dist/osh.spec
    - .packit.yaml

# Packages need to generate srpm and version info
srpm_build_deps: [git, make, python3-setuptools_scm, rpm-build]

# `packit` should not generate a release tag
update_release: false
actions:
    # Generate spec file
    post-upstream-clone: ./make-srpm.sh --generate-spec
    # Get current version from generated spec file
    get-current-version: "sed -n 's|^%global version *||p' dist/osh.spec"
    # By default, only spec filename is kept in the Source field
    # Keep complete URL path to the sources
    fix-spec-file:
    - 'sed -i "s|^Source:.*|Source:         https://github.com/openscanhub/openscanhub/archive/refs/tags/%{name}-%{version}.tar.gz|" dist/osh.spec'

# Do not automatically merge the PR to the target branch
merge_pr_in_ci: false

jobs:
    - &copr
      job: copr_build
      trigger: pull_request
      targets:
          - fedora-all-x86_64
          - epel-8-x86_64
          - epel-9-x86_64

    - <<: *copr
      trigger: commit
      owner: "@openscanhub"
      project: "devel"
      branch: main

    - &testing_farm
      job: tests
      trigger: pull_request
      targets:
          - fedora-latest-stable-x86_64
          - epel-8-x86_64
          - epel-9-x86_64

    - <<: *testing_farm
      trigger: commit
      owner: "@openscanhub"
      project: "devel"
      branch: main
